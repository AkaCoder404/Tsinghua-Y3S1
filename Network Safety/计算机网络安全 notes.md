# 计算机网络安全 notes

[TOC]

# Why Learn Network Security?

(1) communication is everywhere (2) cybersecurity is everywhere 

## 无处不存在的通信

信源、信道、信宿 - source, channel, sink 

“三网合一” - 计算机网络，电信网 （telecommucation network），有线电视网

### 电信网的发展历程

电报（pagers）- 摩尔斯电码 morse code (p)

电话（phone）

- initial questions: how can mechanical energy of sound be converteded into electrical energy and transmited? how are the microhpones for making calls and recievers for listening to calls constructed?

交换机 switches - 人工 -> 自动 -> 程控

电磁波和无线电 

- electromagnetic waves (energy) can spread across space , creation of radio technology

无线话音传送 - wireless voice transmission

对讲机和寻呼机 - walkie talkie and pager

无线电话

- 载波（carrier）, physical basis and carrier tool for transmitting information
- carrier wave is radio wave generated by an oscillator and transmitted on a communication channel, which is modulated to transmit voice or other information

- cellular network and cellular system, AMPS and GSM

蜂窝移动通信系统

- composed of three parts: NSS, BSS, and MS
- 1G -> 4G

### 计算机王路平发展历史

1950 era without internet : no terminal, expensive, data resources cannot be shared

1954 终端 terminal: 收发器 （transceiver），电传打字机（teletype)，拓扑结构（typology)

50-60 prototype computer network, host-communication line terminal, terminal oriented computer network

1969 ARPANET： structure, store and foward, packet switching (分组交换)， IMP (i)

1970 网络之间无法互联 : different network structures cannot be interconnected 

1983: Interconnection of network, TCP/UP

> definition of computer network: a computer network is a collection of autonoumous network, interconnected by communication channels

- divided into two subnets: communication and resource subnet

- composed of computer systems, communication links, and networks nodes

## 无处不在的网络安全

safety progress changes 

- computer applications (need automatic tools to protect files and information stored in the computer)
- application of distributed systems and networks (information needs security protection during data transmission, processing and storage)

If internet is unsafe/unreliable, it will affect people's  work, study, and life, and even affect the safety and stability of entire society.

Hackers, one aim, "profit"

争夺“信息”资产, competing for "information" assets, what do we need to protect?

窃取途径和攻击技术 steeling and attack techniques

- steal: data stolen during network transmission, trojan horse virus, data stored on network system is stolen, user was phished and leaked
- attack: based on vulnerables, 中间人攻击, trojan horse, brute force, social engineering, 拒绝服务攻击

different levels of 黑色产业分工

1. 漏洞挖掘 - vulnerability mining: Research and dig out the program loopholes of various systems such as operating systems, and sell loophole product information; at the top of the industry chain, it has a high level of knowledge
2. 代码编写 - chain code writing: vulnerability exploit code, write virus program, sell trojan horse virus
3. 信息窃取 - use attack codes to attack website system, use viruses to attack ordinary users, steal large amount of user information, brute force hacking,
4. 信息贩卖 - user information obtained through third layer of online sales
5. 窃取诈骗 - use purchased or obtained information to defraud users and those around him

信息窃取攻击

1. 蛮力破解 Brute Force Attack
2. 中间人攻击 : data monitoring/tampering between two victoms 
3. 拒绝服务攻击: prevent the provision of services by crashing a computer
4. 病毒（恶意软件）

## 互联网中的防守

encryption, decryption, encrypt data in network, access control and identity auth, prevent illegal access, firewall, 

antivirus tech, path technology

加密之王Enigma: maker and dicipherer

- cryptographic machine using rotar desgined by Arthur Scherbius

- enigma dicphering machine Bomber by Alan Turner

- principle not complicated, but basically impossible to crack before WWII
- uses 代换密码算法 （Substitution cipher）

- Rotor Machine
- 反射器 reflector

> https://www.theguardian.com/technology/2014/nov/14/how-did-enigma-machine-work-imitation-game

Increase Strength

- 26*26*26=17576 options for the initial directions of the three rotaters
- The three encryption wheels of Enigma are made into a form that can be easily and freely disassembled, and users can adjust the order by themselves
- A connection board is added between Enigma's keyboard and the first wheel. The connection board allows the user to connect a certain letter to another letter with a signal line, so that the signal of this letter enters the wheel It will be transformed into a signal of another letter before. This kind of connection can have up to six or more
- 17576 x 6 x 100391791500, which is about 100 million possibilities

# Cryptography

## 初识密码

password is different from hiding, a safe and secret letter are different, password is different from access control, password is for access control, there is no encrypted data, and security is often weak

古代军事：军事密码本
古代商业：平遥票号
密码案例：暗语
密码案例：跳舞小人

隐写术 - stenography, hide the existence of information: character marking, invisible ink, 针刺、打字机的色带校正, simple but hard to construct, not robust 

### 密码学的基本概念

传统加密（traditional encryption） and 公钥加密 （public key encryption）

- traditional encryption also consist of 对称加密、单钥加密

- 代换密码（subsitution password）、置换密码（replacement password 、二者组合 (combination of both), not suitable for large organizations
- users cannot understand security of algorithm

现代加密又称为非对称加密（assymmetric）、公钥加密

- separate algorithm from key, make encryption algorithm public, keep the key secret, security depends on key

明文（plain text）original understandable information or data

密文（cypher text）encrypted information

加密（encrypt,encryption) the transformation from process from plaintext to cipher text

解密（decrypt, decryption) the transformation process from ciphertext to plain text

密码算法 algorithm, 密码 cipher，密银 key： c=E(m), m=D(c) , D(E(m))= m

cryptography and cryptanalysis (deciphering)

- cryptographic system (1) operation type to convert plaintext to ciphertext (2) keys used (3) ways to deal with plaintext
- 转换明文为密文的运算类型： transposition and substitution
- 所用的密银数 symmetric (sender and receiver same key), and asymmetric (sender and receiver and different keys aka public key)
- 处理明文的方法 block cipher and stream cipher

a encryption mechanism is computationally secure when 

> the cost of breaking the password is greater than the value of the encrypted data itself, or the time to dicpher the password exceeds the lifetime of the ciphertext message

wireless telegraphy gave birth to modern cryptanalysis

## 古典密码

### 代换技术 Subsitution Cipher

> method of replacing plaintext leters with other letters, numbers or symbol

1. Casear 密码:
   1. c = (m + 3) % 26, brute force attacks can be used to decipher the Caesar password, only need 25 test keys
2. 单表代换密码 
   1. set keyword in front, rest of letters in order
3. Playfair 密码 http://www.practicalcryptography.com/ciphers/playfair-cipher/#the-algorithm
4. Hill 密码 http://practicalcryptography.com/ciphers/hill-cipher/
5. Vigenere 密码 http://www.practicalcryptography.com/ciphers/vigenere-gronsfeld-and-autokey-cipher/
6. Verman 密码和一次一密 https://cryptomuseum.com/crypto/vernam.htm

### 置换技术 Transposition Cipher

> method of forming new arrangement through transposition (replacement)

http://www.practicalcryptography.com/ciphers/columnar-transposition-cipher/

### 破译举例 Deciphering Examples

two common methods 穷举法 （exhaustive ）和频率分析法（frequency analysis）

## 对称密码算法

symmetric cryptographic algorithm

##对称密钥密码：
### 对称密钥密码：S-DES (simplified DES)

- same password to encrypt and decrypt, must use secret channel distribution
- data encryption standard

input: 8 bit plain text group, 10 bit key

output: 8 bit cipher text group

https://www.codeproject.com/articles/91628/simplified-version-of-the-des-data-encryption-stan#:~:text=Figure%20C.1%20illustrates%20the%20overall%20structure%20of%20the,produces%20an%208-bit%20block%20of%20ciphertext%20as%20output.

check ppt for more complete algorithm

pretty easy once you know all the parts and process

### Feistel 密码结构

流密码：stream cipher encrypts one bit/one byte of the data stream at a time

分组密码: block cipher is to encrypt a plaintext group as a whole and obtain a ciphertext group of the same length (64 bits or 128 bit)

use 乘积密码（product ciphers）to approximate 简单代换密码, using two or more 简单密码 will result in password strength that is stronger 

using substitution and permutation interchangeably

混淆和扩散 confusion and diffusion

Claude Shannon, introduced obfuscation and extension to characterize the two basic components on how to defeat cryptoanalysis based on statistical methods

- diffusion refers to dissipating the statistical characteristics of plaintext in the ciphertext, so that each plaintext number affect multiple ciphertext numbers as possible
- confusion is to make the statistical relationship between the cipher text and encryption key more complicated.

longer packet length/key, higher the security, but diminish encrypt/decrypt speed, more iteration equals more security, more complex function, stronger the anti-attack ability

https://asecuritysite.com/encryption/fei

### DES算法

key length is 56 bits, packet length is 64 bits

except for initial permutation and end permutation, the structure of DES is exactly the same as the Feistel Cipher structure

sub key generation

1. sep into different parts
2. rotate shift based on which step
3. compression permutation 

steps

1. IP
2. substeps
   1. split into left and right 32 bits
   2. left i = right i - 1, right i = left i - 1 xor f (right i - 1, Ki)
   3. f is made up of E盒扩展置换， xor, and S 盒代换选择, and P盒置换
3. repeat for all 16 substeps
4. IP-1 

Most important symmetric cryptographic algorithms

- 3DES (encryption standard to come, but to slow to be implemented in software, and should have longer packet length)
- Blowfish 
- RC5 

### AES advanced encryption standard

security as good as 3DES, symmetric block cipher with block length of 128 bits, and can support 128 bit, 192 bit, and 256 bit keys

- immune to all known attacks
- various platforms, its execution speed is fast and code is compact, simple design
- not Feistel structure, each round uses substitution and permutation to process the entire data packet in parallel
- constructs of four stages, one permutation and three substitution  and three substitutions, and each stage is reversible

## 非对称密码算法

defects of symmetric key crypto system: must be distributed through a secure channel, cannot be used for digital signature, key management is complex,

asymmetric key cryptography, (1 public key, 1 private key), only real revolution in history of cryptography, based on mathematical functions rather than substitution and permutation

会话密银Ks session key

> session key:  a session key is a single use symmetric key used for encrypting all messages in one communication session

用户A的公银 KUa, user A's public key

用户A的私银 KRa, user A's private key

E KUa [ P]：用 A 的公钥对明文 P 加密, use A's public key to encrypt plaintext P

E KRa [ P]：用 A 的私钥对明文 P 加密, use A's private key to encrypt plaintext P

D KUa [ C]：用 A 的公钥对密文 C 解密, use A's public key to decrypt ciphertext C

D KRa [ C]：用 A 的私钥对密文 C 解密, user A's private key to decrypt ciphertext C

anyone can use public key to encrypt message, but only the party with private key can decrypt

公银密码系统的签名原理

A sends message to B, encrypted and signed with A's private key （签名）

After B recieves the cipher text, it uses A's public key to decrypt and verify （验证）

### Mathematical Principle of Public Key Cryptography: 

陷门单向函数 Trapdoor one-way function

one way function is function that is difficult to invert, one way trapdoor function is a function that is difficult to invert without knowing the trapdoor information. The trapdoor information is known the inversion is easy to implement. 

1. Given x, it is easy to calculate y=f(x)
2. Given y, it is difficute x so that y=f(x)
3. There is δ, for any given y when δ is known, if the corresponding x exist, then it is easy to calculate x so that y=f(x),

part 3 is trapdoor property, and δ is trapdoor information

### purpose of public key cryptosystem

1. encrypt and decode 
2. digital signature
3. key exchange (both parties negotiate a session key for symmetric key data encryption)

also vulnerable to brute force attack, but the complexity of the mathematical function is exponential,  so solution to brute force attacks is simply using a longer key, but it must be short enough for reasonable implementation

### 对称密码 vs 非对称密码

misunderstanding 1: public key cryptography is more secure than traditional cryptography

security of any encryption method depends on the key length and amount of calculation required  to decipher the ciphertext

misunderstanding 2: public key cryptography is universal, and traditional cryptography is outdate

misunderstanding 3: handshake with the key distribution center in traditional cryptography is an extremely troublesome thing, while public key cryptography is simple to achieve key distribution

## 非对称密码：数论基础

prime number, gcd, relatively prime when gcd(a,b)=1, mod (mod calculations)

Euler function Φ（n），n is positive integer,  Φ（n）are all positive integers smaller than n and relatively prime to n

Euler Definition

## 非对称密码：RSA算法

RSA is a block cipher whose plaintext and ciphertext are both integers between 0 and n-1, and size of n is 1024 bit binary or 309 bit binary

### RSA 的产生

1. take any two prime numbers, p and q, 
2. calculate n = pq, 
3. use euler function Φ(n) = (p-1)(q-1)
4. chose any small integer e so that its relatively prime to Φ(n)
5. find d, so that de ＝ 1 mod Φ(n) , or de = k Φ(n)  + 1,
6. 公开 (e,n), d 保密, p,q 弄丢

公开密钥 :KU={e, n}
秘密密钥 : KR={d,n}

加密过程： divided the content to be encrypted into k-bit packets, k < log(2n), write as number, let it be M, then C = M^e mod n

解密过程: M=C^d mod n

### RSA 算法的安全性

attack methods, brute force attack, mathematical attack, timing attack

brute force attack: try all keys

1. mathematic attack: factorization of the product of two numbers
2. timing: similar to guessing the password by observing the length of time someone turns the dial of the safe, attacker can determine the private key by recording the time it takes the computer to decrypt the message.

MIPS year, resisting key space by increasing key length (but also slows system)

## Diffie-Hellman秘银交换算法

enable two users to exchange keys securley, only limited to key exchange

本原根primative root

定理: a is the primative root of p if

a mod p, a^2 mod p, a ^(p-1) mod p is a permutation from 1 to p-1, that is, each is different, is a permutation of integers from 1 to p-1

![image-20201211210431379](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201211210431379.png)

i is called the discrete logarithm or exponent of b with a as the base module p

过程 is in powerpoint

![image-20201211211203953](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201211211203953.png)

### 密码功能的设置
what to encrypt and where -> link encryption, end to end encryption

symmetric or not, strength of any cryptographic system is related to key distribution method, distribute in ways that other people won't know, different types

1. traditional symmetrical password distribution
2. public key distribution in asymmetric cryptography
3. public key cryptography is used for key distribution in traditional cryptosystems

## 传统的对称密码分配

1. selected by A and handed to B in person
2. third party chooses key and hands it to A and B in person
3. if A and B have used a certain key before, one of them can use it to encrypt a new key before sending it to the other party
4. A and B have secret channels with third party C, C can secretly send a key to A and B respectively.

KDC example

## 公银的分配

for types of commonly used public key distrbution methods

1. 公开分布 public release, PGP
2. 公开可访问目录 publicly accessible directory, a trusted entity or organization is responsible for the maintenance and distribution of a public key directory
3. 公银接受 public key authorization, user sends request to administrator, requesting B's current public key
4. 公银证书 public key certificate, pass key information to other party bypassing certificate that can be verified by other parties

## 利用公钥分配传统密码的密钥

Due to the slow speed of public key cryptography, almost no users ar ewilling to use public key cryptography completely in communication, so public key cryptography is more suitable as a means of realizing key distribution in traditional cryptography

1. simple key distribution
2. key distribution method with confidentiality and authenticity
3. hybrid method

# Authentication

## 消息认证

### 网络环境终得攻击

泄密 Disclosure, disclose message to recipient who does not have legal key, 传输分析 analyze communication mode of both parties, 伪装 camouflage

### 消息认证的概念

verify that received message is indeed from the real sender and has not been modified, order and timeless, 

can be seen as two layers, function that generates authenticator, value used to authenticate message, above protocol uses this function as a primitive so that receiver can verify the authenticity of the message

发送方否认：sender denies that a certain message has been sent

数字签名:  digital signature counters sender denial (authenticate whether sender is correct)

> A **digital signature** is a mathematical scheme for verifying the authenticity of digital messages or documents. A valid digital signature, where the [prerequisites] are satisfied, gives a recipient very strong reason to believe that the message was created by a known sender [authentication], and that the message was not altered in transit [integrity]

认证函数： function that generates  (3 categories)

1. message encryption, cipher text of entire message used
2. message authentication code (mac), public function of the message and key, generates fixed-length value
3. Hash function: public function that maps arbitrarily long messages to fixed length hash values.

### 消息加密

in traditional ciphers and public key ciphers, analysis of message encryption is different

method to solve message authentication in symmetric encryption is to require the plaintext to have a certain structure that is easy to identify, and this structure cannot be repeated without passing the encryption function

FCS, 帧校验， use message to generate FCS, append to M, and encrypt together. 

TCP Protocol, everything but IP address can be encrypted

public key encryption only provides confidentiality, not authentication, if you want to provide both, sender A can first encrypt the digital signature with its private key, then encrypt it with B's public key

Symmetric Encryption - provide confidentiality, provide authentication, cannot provide digital signature

Public Key Encryption - provide confidentiality, provide authentication and signature, provide confidentiality, authentication, and signature

### 消息认证码 MAC

Uses a password to generate short data block of fixed length and appends data block to the message, is a function of message and key

MAC = $C_k(m)$, M is input message, C is function, K is shared key, MAC is authentication code 

similar to encryption, but difference that MAC algorithm that does not require reversibility

过程

1. A and B share password K
2. Sender calculates and appends MAC, sends to reciever together
3. Receiver calculates MAC with the same key K for received message, and compares it with the received MAC
4. Because both the sender and receiver share the key, MAC cannot provide a digital signature

authentication and confidentiality are usually used in combination

- authentication related to plaintext
- authentication related to ciphertext

separating authentication and confidentiality can make structure of applications more flexible.

### HASH 函数

a variant of MAC, input M, output H(M), but does not use secret key, just input message. Also called (Message Digest or MD)

Function of all message bits, has error detection capability, which means changing any one or more bits of the message will cause the hash code to change

1. use symmetric password to encrypt message and hashcode attached to it, since A and B share a key, message must come from A has not been modified, provides structure/redunancy for authentication, and encrypts entire message and hash code, so it provides confidentiality
2. use symmetric to encrypt only hash, no confidentiality and provides authentication while reducing processing cost,
3. encrypt hash code with public key password and senders private key, can provide authentication and digital signature
4. senders private key to encrypt the has code, then use the key in the symmetric password to encrypt the message and above encryption result, more commonly used, provide auth, sig, and conf
5. assuming both parties share common secret value S, a connects M and S before calculate hash value, and appends to M, since B knows S, it can calculate hash value and verify its correctness, since S is not transmitted, intercepted messages can not be forged, and authentication is provided.
6. encrypt entire message and hash code, provide conf and auth

不使用加密函数： if confidentiality is not required, encryption function can be omitted, thereby reducing the computational cost,  omitted for many reasons

Hash function requirements

1. can manipulate messages of any size m
2. given an arbitary length of m, resulting h has a fixed length,
3. given m, calculating h=H(m) is easy
4. given h, it is difficult to find m 
5. given m, it is computationally infeasible to find m', $m' \neq m, H(m) = H(m') $
6. Find any (x,y) x≠y such that H(x) =H(y) is computationally infeasible

### HASH 算法： 安全hash函数得一般结构

aka 迭代hash函数, widely used ones are MD5, SHA1, RIPEMD-160, all adopt this structure

hash function divides the input message into L fixed length packets, each packet has a length of b bits. When the last packet is less than b bits, it needs to be filled so that it is b bits

length included in input increases difficulty of attack, because the attacker must know

1. two messages with same hash value and equal length
2. or find two messages with different lengths, but same has value after adding the message length

![image-20201212193702939](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201212193702939.png)

The compression function f is reused in the Hash function,

1. its input is the n-bit result obtained in the previous step (that is, the connection variable) and a b-bit group, and the output bit is an n-bit group
2. The initial value of the connection variable is specified at the beginning of the algorithm, and its final value is the hash value. Usually b>n, so it is called compression function
3. If the compression function has anti-collision ability （抗碰撞能力）, then the iterative hash function also has anti-collision ability; it can be seen that designing a safe hash function can be summarized as the problem of designing a compression function with anti-collision ability, and the input of the compression function is fixed-length
4. Because in the hash function, b>n, the message with a packet size of b bits is mapped to a hash code of length n, so any hash function has collisions, so it is required to find out the collisions that are not feasible in the calculation

> a collision or clash is a situation that occurs when two distinct pieces of data have the same hash value, checksum, fingerprint, or cryptographic digest., **when something happens to the data sent from the physical network medium that prevents it from reaching its destination**. Mainly, it encounters another signal from another host on the network that yields a resulting useless signal on the network when the signals combine.

### Hash算法，主要得hash算法概述

MD, Message Digest (消息摘要)

1. MD2, MD4, MD5, RIPEMD

SHA Secure Hash Algorithm

national security agency issued SHA as government standard

SH0, SH1 (similar and successor to MD4 and MD5), SH2 (divided into 256, 384, 512), SHA3 (proposal is being collected)

Others: HAVAL, Gost, 

### Hash算法: MD5

> Message Digest is **used to ensure the integrity of a message transmitted over an insecure channel (where the content of the message can be changed**). The message is passed through a Cryptographic hash function. This function creates a compressed image of the message called Digest.

input of MD5 is message of any length, processed in units of 512 bits, and the output of the algorithm is a 128 bit 消息摘要

goals: 

1. speed, computational infeasible to find two message with the same digest
2. simplicity and conciseness, algorithm should be easy to describe and easy to program
3. use low-end structure (低端结构)

![image-20201212201114001](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201212201114001.png)

![image-20201212201305045](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201212201305045.png)

## 石破惊天 MD5 堡垒轰然倒塌

### Hash算法： SHA

based on MP4

input of SHA1 algorithm is a message with a length of less than 264 bits, and the output is a message digest of 160 bits. input message is processed in units of 512 bits 

Steps

1. increasing filling bits
2. fill the length
3. initialize MD cache
4. process messages in 512 bit groups, (16 word and bits units)
5. output

### Hash 算法：各 类算法比较

![image-20201212210633347](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201212210633347.png)

1. can resist brute force attacks, not vulnerable to weak collision attacks, MD5 is prone to strong collision attacks due to its short message digest, SHA1 and RIPEMD160 will be safe against strong collision attacks in the future
2. cryptanalysis resistence, SHA1 more difficult than MD5, RIPEMD160 more than SHA1
3. speed: MD5 relatively simple and has fewer iterations, so it runs the fastest

## 数字签名算法 DSS

message authentication can ensure that the communicating parties are not attacked by a third party, but it cannot handle the attacks that occur on the communicating parties themselves.

digital signature similar to handwritten signature, and must have the following characteristics

1. verify the signer, by signing date and time
2. authenticate the content of the signed message
3. signature should be arbitrated by a third party to resolve disputes

can be divided into two categories: 直接数字签名和仲裁数字签名
Direct digital signature

- involves only both parties
- assuming that the receiver knows public key of the sender, the sender can generate a digital signature by encrypting the entire message or the hash code of the message with its own private key
- use the reciptents public key and shared secret key symmetric password to encrypt the entire message and signature to obtain confidentiality
- depends on the security of the senders private key

仲裁数字签名 Arbitration Digital Signature

- each signed message from the sender X to the receiver Y is first sent to the arbitrator A, A checks the message and its signature to verify the source and content of the message, and then adds a date to the message and sends it to Y, also indicate that the message has passed the arbitrator's inspection

DSS uses the SHA1 algorithm and provides a new digital signature method, namely the digital signature algorithm DSA

DSS is a public key method, unlike RSA, DSS cannot be used for encryption or key distribution, only provides digital signatures

### 签名过程与验证过程

。。。

## 身份认证技术 Identity Authentication

（电子身份认证简述）

Identity Authentication refers to a solution to confirm the identity of behavior participants (subjects or objects, usually called users) in the process of subject-object interaction, 3 ways

1. what you know: prove identity based on information you know
2. what you have: prove your identity based on what you have
3. who you are: proof of identity, directly based on unique physical characterer

electric identity authentication is a solution to confirm the identity of the operator in the computer in the computer and the network, is performed on specific data that represents a data

### 构建安全网站得技术手段

正面： 认证， 接受， 审计（auditing)

反正： eliminate loopholes at all levels (bug) 

website is a complex system, and a security issues involves many aspects

### 网站身份认证技术 Step by Step

Web, World Wide Web, and its basic structure is an open client server structure (C/S)

divided into three parts:

1. server side: web side 
2. client side: browser, dedicated program
3. communication protocol: HTTP protocol

commonly used technologies in website systems: html, JavaScript, multimedia technology, server technology

HTTP协议： application layer protocol based on TCP/IP

- typical C/S working method, simple and fast, less data transjmission
- any type of data object can be transmitted via HTTP protocol
- HTTP is a stateless network protocol for one connection

网站用户认证技术

HTTP's Basic authentication, 表单身份认证 （form based authentication）， such as  SMS password, dynamic password, usb key, 数字证书

mechanism principle: 账号 + 静态口令

since HTTP protocol is a a stateless network protocol is a stateless network protocol for one connection, it is necessary to send the plain text of the user's identity credentials to the service every time an HTTP request is made. On the server side, the server compares the user credentials stored on the server side.

advantage: simple

disadvantages:  account and password need to be passed, easy to be monitored and stolen, low security, local browser also needs to save the account and password, which poses a security risk, server-side processing each HTTP request requires an authentication process, which is inefficient

Improvements:

1. solve clear text transmission of password by using encryption technology, use message authentication. solve the problem of long-term local storage of account passwords on server side by uing form authentication and session mechanism
2. account password encryption using key, (U || Ek[U]), can use any symmetric encryption algorithm
3. use MAC authentication technology in message authentication,client and server share common password, K. use challenge response (two requests are required)
   1. server returns a challenge code M to the client (randomly generated)
   2. the client sends the MAC code using MAC authentication, and the server verifies it, can use hash algorithm

基于表单的身份认证：web的session机制

unique identifier stored in memory/local file in server, and cookie in client side. deleted after a certain amount of time

3 steps of form-based web authentication process.

1. sends request to server, and server returns a page containing the form
2. client sends filled form content to the server, after the server receives and verifies the form, the session is started and returned to the client
3. the client's subsequent request contains the unique identifier of the session, and the server verifies the legitimacy of the unique identifier (usually based on a hash table data structure with an identifier as the key)

improvements

1. use challenge/response mechanism
2. when account password is transferred, use the transport layer SSL to transmit HTTP request.

ways to enhance identity authentication: SMS, dynamic, USB key, digital certificate (two form, multi form)

# CIA-IPsec-IKE

## 计算机网络安全体系结构

CIA： confidentiality, integrity, availability

confidentiality: 保密性，机密性, protect information content from being leaked to unauthorized entities

integrity: ensure that the information is not modified without authorization 

availability: 可用性: ensure that authorized users of resources can access the resources or services the deserve, and prevent denial of service attacks

OSI Security Framework: X.800: focuses on security services, security mechanism and security attacks

![image-20201213202024742](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201213202024742.png)

安全服务：Security Services

X.800 provides the following security services: 

1. 认证服务：authentication
   1. peer authentication
   2. data authentication
2. 保密服务：confidentiality
3. 数据完整性保护： integrity
4. 访问控制服务：access control
5. 坑抵赖服务：non-repudiation, prevent the sender or receiver from denying transmission or receiving a message
6. 可用性服务 availability, being able to access or use the system and its resources in accordance with the requirements of authorized system entities

普通 Security Mechanisms

1. trusted functions
2. security labels
3. event detection
4. security audit trail, (collect data for security audit, independent review and inspection of system records and behavior)
5. security recovery, handle request from security mechanisms

8 ordinary security mechanisms

1. 加密机制
2. 数字签名机制
3. 访问控制机制
4. 数据完整性机制
5. 认证机制
6. 业务流填充机制
7. 路由控制机制
8. 公证机制

Security Attacks

1. active attack: try to change system resources or affect system operation
2. passive attack: attempts to understand or use system information without affecting system resources

## 网络层安全协议 IPsec

IPsec, guarantees IP level security, including

1. authentication: ensure that received packet is sent from the source identified by the packet header, and that packet has not been tampered with during transmission
2. confidentiality: message is encrypted and transmitted to prevent third-party eavesdropping
3. key management: key management mechanism is related to the secure exchange of keys

security features of existing IP protocols

1. no connection, packet arrival order not guarenteed, duplicate packets, missing packets, simple and stateless, no authentication, no completeness, no confidentiality, access control incomplete, contains 20-byte header and data from the transport layer

principle of IPsec is that all traffic can be encrypted and or authenticated at the IP layer, applicable in both IPv4 and IPV6

gives ability to communicate securely in local areas, wide area networks, and the internet, uses include

1. branches are connected safely through Internet (no need for own private network, can just use VPN)
2. remote and secure internet access
3. establish extranet and intranet connection with partners 
4. strengthen e-commerce security

IPSec的实施 implementation: host

1. implemented on host (integrated with operating system
2. ensure end to end security
3. provide security for each user's session
4. transparent to the application, no need to modify software or user server system
5. can be transparent to end users

firewall, provide security services for all internal applications

implemented on routers (vpn), can provide security protection for data flowing between two subnets through a public network

### IPSec 体系结构

IPsec has plenty documentation, IPv6 has to support both, IPv4 has to support one of the following

- extended header of packet authentication called AH
- extended header of packet encryption called ESP

IPsec文档 divided into 7 parts: 体系结构，认证头，疯转安全载荷， 加密算法，认证算法，密银管理，解释域

IPsec服务： provide security services at the IP layer. The system can select required security protocol, determine the algorithm used by the service and provide the encryption key required for the security service, use AH and ESP for data packets security, support access control based on distributed keys. 

SA, negotiation of certain elements between IPsec communication parties, a set of security information parameters. 

SA determined by 3 paramters, SPI, IPDA, security protocol identification., SADB defines parameters associated with each SA, security association is uniquely identified by the destination address in the header, and SPI is encapsulated in the AH or ESP extension header

SA的参数

1. 序数计数器 ordinal counter
2. 序号溢出标志 sequence number overflow flag
3. 反重放窗户 anti-replay window
4. AH信息
5. ESP信息
6. SA生存期
7. IPSec协议模式
8. Path MTU:

SADB functions must exist, but method of providing functions depends on implementer, linked to authentication and confidentiality mechanism through the security parameter index spi

传输模式 transmission mode: mainly provides protection for upper-layer protocols, increases protection of IP packet load, used for end to end communication
隧道模式 tunneling mode: protection for the entire IP packet, AH/ESP domain added to the IP packet, entire data packet and security domain are treated as a new IP payload and have a new external IP header

### 认证头 Authentication Header

supports data integrity and IP packet authentication, based on MAC

认证头的组成 

反重防攻击 attacker receive an authenticated packet and transmitting it to the destination site.

完整性校验值 ICV: mac or truncation code generated by mac algorithm

### 封装安全载荷 Encapsulating Security Payload

encapsulated security payload ESP provides confidentiality services, including messages content confidentiality and traffic restriction, can provide the same authentication services as AH

ESP格式

1. 安全参数索引
2. 序列号
3. 有效载荷长度
4. 填充域
5. 填充域
6. 邻接头
7. 认证数据AD

payload data, padding data, padding length, and neighboring header fields are all encrypted in ESP. Available encryption algorithms are 3DES, RC5, IDEA, CAST, Blowfish

transmission ( encryption and authenication directly provided by two hosts ) vs tunneling  (encrypt entire IP packet)

### 网安联组合

single SA can implement AH or ESP, but not both. 

can be combined in two ways: transport adjancecy and tunenel interation

## IKE 为 IPsec管理密银

SADB and SPDB (means of linking IP information flow with SA, and determines which data packets in and out to perform safe operation authentication or encryption/decryption)

two types of key management

- manual: system administrator manually configures various keys required for each system. the SA always exists and is used in small-scale simpled-structered networks
- automatic: sa is generated through negotion in a large scale distributed system, can be renegotiated after the SA expires, which is suitable for network with more complex topologies and higher security. 

IKE protocol provides IPSec with services of auto-negotiation and exchange of keys and establishment of security association SA, which simplifies the use and management of IPsec

transmit key through series of data exchanges

can also maintain SADB

### IKE的报文格式

IKE message is also called ISAKMP, 

can be used on transport layer or IP layer

13 different 载荷

### IKE的体系结构

first stage, negotiate to create a communication channel, and verify the channel to provide confidentiality, message integrity, and message source verification services for further IKE communication between the two parties: main method, quick mode

in the second stage, use the established IKE SA to establish an IPsec SA: quick mode

第一段 vs 第二段

### IKE 的工作模式

end to end node: us transmission 

security to security gateway: uses tunnel mode

### IKE 的工作过程

In terms of protocol implementation, IKE runs in the background as a daemon. There are two ways to start the IKE service. 

Kernel submits a request to create an IKE SA, or the same-level IKE daemon submits a request to negotiate SA

two daemons pass messages through the UDP, uses two databases : SADB and SPDB, both stored on operating system kernel

SPDB has pointer hidden in each entry, for both outgoing IP and income IP packets, table must be first queried to determine whether to discard, bypass or apply IPsec

after the IKE daemon recieves the request from the kernel, it queries the SPDB to get all the negotiation parameters, then sends a negotation request to the remote IKE process, and the IKE process starts the negotiation

if negoation is successful, add newly negotatied SA to the SADB,if it fails, IKE will prompt the policy and SA management module, and admin will configure the SPDB parameters

when administator instructs the IKE daaemon to no longer use a certain SA, the IKE daemon deletes the corresponding record SA from the SADB, and at the same time, sends message to the remote IKE daemon indicating that the SA is no longer used locally

remote IKE process can choose to do two things in response to this: delete SA or ignore (but SA can no longer be used)

# Access Control

## 访问控制基本概念

主体 subject: active entity that makes request for resources access

客体 object: passive entity containing access resource

访问 access: use of resources

访问控制信息 ACI: subject, object, access attributes/rules

授权 authorization: assign access control info to sub or obj, browse modify, reclaim access control permissions

access control list: access control list is associated with the object and specifies the subject and authority that can access it. capability list: associated with the subjects and specifies the object and permissions that subject can access

![image-20201221232705426](C:\Users\ligeo\Desktop\Y3S1\Tsinghua-Y3S1\Network Safety\计算机网络安全 notes.assets\image-20201221232705426.png)

AAA 认证，授权，审计 

## 防火墙的基本概念

防火墙的各种分类： 结构，性能，应用

常用技术 service control, direction control, user control , behavior control

防火墙技术上划分四类

1. packet filtering/screening
2. NAT
3. circuit gateway
4. proxy

what it can do

1. provide single blocking point
2. provide security event monitoring point
3. convenient platofrm 

## 防火墙的配置结构

- 单盒结构 (Single Box Architecture): simple packet filtering function
- 屏蔽主机结构 (Screened Host）
- 屏蔽子网结构 (Screened Subnet）

## ACL 访问控制列表

similar to lab

...

# SSL- HTTPS

## 传输层安全协议

SSL secure socket layer 

works on top of TCP protocol, does not support UDP, ensure information is not modified: similar technologies as all the IPsec, IKE to protect information

SSL establishes an encrypted channel on top of TCP, and the data passing through this layer is encrypted, so the effect of confidentiality is achieved.

会话 session: association between the client and the server, virtual connection relationship. established through 握手协议 to negotiate cryptographic alg...

- 绘画标识
- 同位体证书
- 压缩方法
- 密码规范
- 主密码
- 可恢复性 is resumable？

连接 connection: specific communication channel, usually mapped to TCP, shored lived

- 服务器和可短随机数 server and client random
- 服务器写mac密码
- 客户端写mac密码
- 服务器写密码 server write key -> client read key
- 客户端写密码 client write key 
- 初始化矢量 initialization vector
- 序列号 sequence number

### SSL 记录协议

two services: 

1. confidentiality : encryption and decryption of message use the shared secret key defiend by the SSL handhsake protocol to encrypt the SSL paylod with traditional key algorithms
2. message integrity: used the shared key (secret) defined by the  handhsake protocol to calculate the mac

SSL记录协议的操作过程

1. fragment 
2. compressing (optional)
3. add mac
4. add encryption
5. add ssl record header

### SSL 握手协议

1. establish security capabilities -> protocol version, session id, cipher suite, compression method, additional random numbers
2. server authentication and key exchange: certification request and key exchange
3. client authentication and key
4. finish: change cipher suite and finish handshake protocol

### WEB安全和HTTPS协议

1. platfrom independence: enable all users to access the information release system without worrying about their different models
2. system distribution: enable all users to provide materials on their own computers with the resources

better to read one article at a time (instead of citing)

hypertext technology HTML

tim berners lee invented (1) html supports hyper link (2) http for publishing resources (3) URL 

actually a client server program running on the internet and TCP/IP

安全目标

1. ensure the security of data stored on the web server
2. snsure that the computer of web client is secure
3. ensure the security of information transmission between the server and browser

two types of attacks: 

- classified according to threat (active attacks and passive attacks)
- classified by threat location (server, client, com security between client and server)

ways to provide web security

1. IP-level security, transparent to end users, provides common solution, also has filtering function
2. TCP level security (such as SSL or TLS)
3. customized security protocols for application

## 针对HTTP的攻击举例

specifies the rules for communication between the browser and the WWW server

flaws: clear text transmission, no data integrity check, stateless link, unable to verify the authenticity of the identity of both parties

common attacks against HTTP:

1. 监听嗅探 sniff 
2. 篡改劫持 tampering
3. 伪造服务 fake server (HTTP protocol does not verify credibility of server, risks of ARP spoofing, DNS spoofing, and phising)



unable to defend against 致命的中间人攻击 man in the middle attack: attackerestablished independent contact with the communicating parties and exchanges the data they receive, can insert new content

HTTP protocol cannot guarantee confidentiality, consistency, and integrity of communcation - thus communication content can be stolen and tampered with

地址解析协议 Address Resolution Protocol 

works at data link layer to realize the mapping between mac address and ip address

no verifcation between two parties, unconditional trust in the information sent, and updated the communication mapping table

ARP 欺骗： spoofing method of man-in middle-attacks

- The attacker can modify the mapping table of any computer in the network by creating a forged ARP frame (request, reply) to cut off the Internet communication of the target host (victim) and steal the target host (key information)

## HTTPS = HTTP + SSL

combination of HTTP and SSL/TSL protocols, solves the problems of data encryption, integrity verification, and server identity authentication

1. HTTP layer: translate user requirements into HTTP request
2. SSL layer: negotiated encryption key with the help of the channel of the lower protocol, and use this key to encrypt HTTP request
3. TCP layer: establish a connection with port 443 of the web server, and transfer the data process by SSL. the recieving end is opposite of the process.
4. SSL establish a encrpted channel on top of TCP, and the data passing through this layer is encrypted, so the effect of confidentiality is achieved

ARP spoofing sniffing can't be avided but plaintext cannot be obtained bc encrypted 

to use ettercap to tamper with the message, first prohibit the server from crompressing the communication content, because the content becomes garbled after compression, and cannot be recognized, after using https, the content is uncompressed and unrecognizable  ciphertext. attacker cannot tamper with commiunication content

small lock in address bar -> HTTPS certification issued by CA

HTTP cannot verify the identity of the server, some browsers seem to do wesbite authentication, but its based on domain name of website, completely unable to resiste DNS hijacking/spoofing

when users visit HTTPS website through 钓鱼 wifi or 恶意代理, server certificate may be replaced. if user continues to use, information may be stolen (browser search bar will be red)

## 能否确保HTTPS安全

SLLStrip: attacks against HTTP

working principle: 

1. first perform man in middle attack to intercept all HTTP traffic
2. replace all HTTPS links that appear with HTTP, and write down all changed links
3. Use HTTP to connect to victems machine, and establish HTTPS with a legitmate server
4. all communication between the victim and the legitmate server are fowarded by the proxy. 
5. icon that appears is replaced with familiar lock icon
6. succeed in defrauding information such as passwords and account numbers without the victim knowing

## 安全电子交易协议SET

Secure Electronic Transaction Protocol SET: convenient, reliable, safe online payment

security issues faced by online payment

- private information such as payment account and passord are stolen
- payment amount is changed
- network paymetn was deliberately attacked, network payment was deliberately delayed, etc

goals include: authenticity, confidentiality, privacy, real-time

characteristics: confidentiality of information, data integrity, card user account authentication, merchant certification

parameters: 

- cardholder
- merchant
- issuer
- acquirer
- payment gateway
- 权威 CA

### 支付处理过程

1. purchase request 
   - order information 
   - payment information : card number 
   - above must be independently encrypted and signed, must be in content to provent merchants from tampering with information caising disputes
2. payment authorization
   1. authorization response
   2. authorization request
3. payment capture
   1. 

# 软件入侵基本原理

invasive software

陷门，逻辑炸弹，特洛伊木马，Zombie，病毒和蠕虫各类恶意行为的基本属性

can be divided into two types: threats that

- depend on host : programent segment that is planned when host program is called to perform a specific function
- independent of host: program segment (病毒) or an independent program (蠕虫，细菌）, when it is executed, it copies itself, and these copies will be in this system or other systems 